## ADDED Requirements

### Requirement: 用户注册与登录认证
The system MUST 提供短信验证+密码双重登录机制，确保账户安全。

#### Scenario: 用户注册
- **WHEN** 新用户注册账号
- **THEN** 系统应要求输入手机号、密码及短信验证码
- **AND** 验证码有效期为5分钟
- **AND** 密码强度需满足：至少8位，包含字母、数字、特殊字符
- **AND** 注册成功后自动登录

#### Scenario: 用户登录
- **WHEN** 用户使用手机号和密码登录
- **THEN** 系统应验证手机号和密码是否匹配
- **AND** 首次登录或异地登录需要短信验证码二次验证
- **AND** 登录成功后颁发JWT令牌

#### Scenario: 忘记密码重置
- **WHEN** 用户忘记密码并申请重置
- **THEN** 系统应发送短信验证码到注册手机
- **AND** 验证通过后允许用户设置新密码
- **AND** 新密码需满足强度要求

### Requirement: 单账户多策略管理
The system MUST 支持用户在单一账户下管理多个量化策略，每个策略独立配置与运行。

#### Scenario: 创建新策略
- **WHEN** 用户在账户下创建新策略
- **THEN** 系统应分配唯一策略ID
- **AND** 用户可为策略命名并设置描述
- **AND** 每个策略拥有独立的代码版本、回测记录、风控规则

#### Scenario: 查看所有策略列表
- **WHEN** 用户查看策略列表
- **THEN** 系统应展示账户下所有策略
- **AND** 显示每个策略的名称、状态（运行中/暂停）、最新收益
- **AND** 支持按收益、创建时间排序

#### Scenario: 切换策略运行状态
- **WHEN** 用户启动或暂停某个策略
- **THEN** 系统应更新策略状态
- **AND** 暂停的策略不接收行情数据和触发信号
- **AND** 运行中的策略实时监控市场并生成信号

### Requirement: 账户资产统一可视化展示
The system MUST 提供账户总资产、各策略收益、持仓分布等信息的统一可视化展示。

#### Scenario: 查看账户总览
- **WHEN** 用户进入账户主页
- **THEN** 系统应展示：
  - 账户总资产
  - 今日收益（金额及百分比）
  - 累计收益
  - 各策略收益占比饼图
  - 持仓标的分布
- **AND** 数据实时更新

#### Scenario: 查看策略详细收益
- **WHEN** 用户点击某个策略
- **THEN** 系统应展示该策略的详细信息：
  - 策略收益曲线
  - 当前持仓明细
  - 历史交易记录
  - 风控指标（最大回撤、夏普比率等）

### Requirement: 个人数据加密存储
The system MUST 对用户的账户信息、策略代码、交易记录进行双重加密存储，确保个人数据安全。

#### Scenario: 账户敏感信息加密
- **WHEN** 用户注册或更新账户信息
- **THEN** 系统应对密码进行哈希加密（bcrypt或argon2）
- **AND** 手机号等敏感信息使用AES-256加密存储
- **AND** 加密密钥独立管理，不存储在数据库中

#### Scenario: 策略代码加密存储
- **WHEN** 用户保存策略代码
- **THEN** 系统应对代码内容进行加密存储
- **AND** 仅在用户访问时解密并展示
- **AND** 加密算法使用AES-256

#### Scenario: 交易记录加密存储
- **WHEN** 系统记录用户的交易数据
- **THEN** 系统应对交易价格、数量等敏感字段加密存储
- **AND** 查询时实时解密展示

### Requirement: 本地数据导出备份
The system MUST 支持用户导出策略代码、交易记录、回测报告等数据到本地，提供加密备份功能。

#### Scenario: 导出策略代码
- **WHEN** 用户选择导出某个策略的代码
- **THEN** 系统应生成.py格式文件
- **AND** 支持用户设置备份密码（可选）
- **AND** 如设置密码，文件内容加密存储

#### Scenario: 导出交易记录
- **WHEN** 用户选择导出某段时间的交易记录
- **THEN** 系统应生成Excel或CSV格式文件
- **AND** 包含买卖时间、标的、价格、数量、盈亏等字段
- **AND** 支持加密导出

#### Scenario: 批量导出账户数据
- **WHEN** 用户选择"导出所有数据"
- **THEN** 系统应打包导出：
  - 所有策略代码
  - 交易记录
  - 回测报告
  - 账户配置
- **AND** 生成加密的ZIP压缩包
- **AND** 用户需设置解压密码

### Requirement: 会话管理与自动登出
The system MUST 管理用户登录会话，支持多设备登录管理与自动登出机制。

#### Scenario: JWT令牌有效期管理
- **WHEN** 用户登录成功
- **THEN** 系统应颁发JWT令牌，有效期为7天
- **AND** 令牌过期后用户需重新登录
- **AND** 支持用户主动刷新令牌延长有效期

#### Scenario: 多设备登录管理
- **WHEN** 用户在多个设备上登录
- **THEN** 系统应记录所有登录设备
- **AND** 用户可在账户设置中查看登录设备列表
- **AND** 支持强制登出某个设备

#### Scenario: 长时间未操作自动登出
- **WHEN** 用户超过30分钟未进行任何操作
- **THEN** 系统应自动登出用户
- **AND** 提示"会话已过期，请重新登录"
- **AND** 未保存的策略代码自动保存草稿

### Requirement: 账户安全审计日志
The system MUST 记录用户的关键操作（登录、修改密码、导出数据等），生成安全审计日志。

#### Scenario: 记录登录日志
- **WHEN** 用户登录或登出
- **THEN** 系统应记录：
  - 操作时间
  - 登录IP地址
  - 设备类型（PC/平板）
  - 登录结果（成功/失败）
- **AND** 日志保存至少5年

#### Scenario: 记录敏感操作日志
- **WHEN** 用户修改密码、导出数据、删除策略等敏感操作
- **THEN** 系统应记录操作时间、操作类型、操作对象
- **AND** 用户可在账户设置中查看操作日志

#### Scenario: 异常登录预警
- **WHEN** 系统检测到异常登录行为（如异地登录、短时间多次失败尝试）
- **THEN** 系统应通过短信或微信小程序推送预警
- **AND** 提示用户确认是否为本人操作
- **AND** 如用户确认非本人，支持一键冻结账户
