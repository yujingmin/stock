## ADDED Requirements

### Requirement: 实盘级回测引擎
The system MUST 支持单策略及策略组合回测，内置真实交易参数配置（佣金、印花税、滑点、T+1规则），确保回测结果贴近实盘体验。

#### Scenario: 单策略回测
- **WHEN** 用户选择一个策略并设置回测时间区间
- **THEN** 系统应基于历史数据运行回测
- **AND** 计算考虑佣金、印花税、滑点等交易成本
- **AND** 模拟T+1交易规则（当日买入次日可卖）
- **AND** 生成回测报告

#### Scenario: 策略组合回测
- **WHEN** 用户选择2-3个策略进行组合回测
- **THEN** 系统应分配各策略的资金比例
- **AND** 模拟组合整体收益与风险指标
- **AND** 对比单策略与组合的表现差异

### Requirement: 真实交易参数配置
The system MUST 支持用户配置真实券商的交易参数（佣金费率、印花税、滑点范围），并预设常见券商的参数模板。

#### Scenario: 配置券商交易参数
- **WHEN** 用户选择自己开户的券商（如华泰证券）
- **THEN** 系统应自动填入该券商的标准佣金费率和印花税
- **AND** 支持用户自定义修改滑点范围（0.1%-0.5%）

#### Scenario: 自定义交易成本
- **WHEN** 用户手动输入自己的实际佣金费率
- **THEN** 系统应保存该配置并应用于后续所有回测
- **AND** 在回测报告中明确标注使用的成本参数

### Requirement: 实盘交易记录导入与复现
The system MUST 支持导入用户的实盘交易记录，复现历史操作场景以验证策略有效性。

#### Scenario: 导入实盘交易记录
- **WHEN** 用户上传券商导出的交易记录文件（Excel/CSV）
- **THEN** 系统应解析文件并提取买卖时间、价格、数量等信息
- **AND** 关联对应的策略信号时间点

#### Scenario: 复现历史交易场景
- **WHEN** 用户选择某段时间的实盘交易进行复现
- **THEN** 系统应基于历史行情数据重新运行策略
- **AND** 对比策略信号与实际交易的偏差
- **AND** 分析偏差原因（如滑点、延迟、主观判断）

### Requirement: 多维度回测报告
The system MUST 自动生成核心指标报告（年化收益率、夏普比率、最大回撤、收益回撤比等），提供策略与基准指数的收益曲线比对。

#### Scenario: 生成回测报告
- **WHEN** 回测任务完成
- **THEN** 系统应自动生成包含以下指标的报告：
  - 年化收益率
  - 夏普比率（标注≥1为合格阈值）
  - 最大回撤
  - 收益回撤比
  - 胜率与盈亏比
- **AND** 展示策略收益曲线与沪深300等基准指数的对比图
- **AND** 标红模拟与实盘的关键差异点（如滑点影响、手续费偏差）

#### Scenario: 导出回测报告
- **WHEN** 用户选择导出回测报告
- **THEN** 系统应生成PDF或Excel格式文件
- **AND** 包含完整的指标表格、收益曲线图、交易明细

### Requirement: 策略参数优化
The system MUST 提供参数寻优功能（网格搜索/遗传算法）、因子有效性分析，并提示过度拟合风险。

#### Scenario: 网格搜索参数优化
- **WHEN** 用户设置参数优化范围（如均线周期5-30）
- **THEN** 系统应遍历所有参数组合并运行回测
- **AND** 返回最优参数组合及对应的收益指标
- **AND** 提示用户避免过度拟合（如最优参数与次优参数收益差异过大）

#### Scenario: 因子有效性分析
- **WHEN** 用户测试某个因子的有效性
- **THEN** 系统应计算该因子与未来收益的相关性
- **AND** 展示因子值分组后的收益分布
- **AND** 判断因子是否具有预测能力

### Requirement: 实盘级模拟交易
The system MUST 对接实时行情，按实盘规则计算交易成本与持仓收益，支持策略自动运行与手动干预，生成模拟与实盘对比报告。

#### Scenario: 启动模拟交易
- **WHEN** 用户启动某个策略的模拟交易
- **THEN** 系统应基于实时行情运行策略逻辑
- **AND** 按照设置的交易参数模拟下单
- **AND** 实时更新模拟账户的持仓与收益

#### Scenario: 手动干预模拟交易
- **WHEN** 用户在模拟交易中手动买入或卖出标的
- **THEN** 系统应记录手动操作并更新持仓
- **AND** 区分策略信号与手动操作的交易记录

#### Scenario: 生成模拟与实盘对比报告
- **WHEN** 模拟交易运行一段时间后
- **THEN** 系统应对比模拟账户与用户实盘账户的收益差异
- **AND** 标注差异≤5%为优秀
- **AND** 分析差异原因（如策略执行延迟、滑点差异）

### Requirement: A股特定规则支持
The system MUST 支持A股市场的特定交易规则（T+1、停牌过滤、涨跌停限制），确保回测结果符合实际市场情况。

#### Scenario: T+1规则模拟
- **WHEN** 策略在某日发出买入信号
- **THEN** 系统应标记该股票当日不可卖出
- **AND** 只有在下一个交易日才允许卖出

#### Scenario: 停牌过滤
- **WHEN** 回测期间某股票停牌
- **THEN** 系统应自动跳过该股票的交易信号
- **AND** 在报告中标注停牌影响

#### Scenario: 涨跌停限制
- **WHEN** 策略发出买入信号但标的已涨停
- **THEN** 系统应判定无法成交
- **AND** 记录未成交原因为涨停
