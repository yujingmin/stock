## ADDED Requirements

### Requirement: 账户级风控规则
The system MUST 支持用户按个人风险偏好预设账户级风控规则（最大仓位、单日最大亏损额度、单只标的持仓比例限制），触发时弹窗提醒并限制交易操作。

#### Scenario: 设置最大仓位限制
- **WHEN** 用户设置账户最大仓位为80%
- **THEN** 系统应在用户持仓达到80%时阻止新的买入操作
- **AND** 弹窗提示"已达到最大仓位限制，无法继续买入"

#### Scenario: 单日最大亏损限制
- **WHEN** 用户设置单日最大亏损额度为账户资金的5%
- **AND** 当日亏损达到5%
- **THEN** 系统应锁定所有交易操作
- **AND** 弹窗提示"今日亏损已达上限，建议停止交易"

#### Scenario: 单只标的持仓限制
- **WHEN** 用户设置单只标的持仓不超过账户资金的20%
- **AND** 用户尝试买入导致某只股票持仓超过20%
- **THEN** 系统应阻止该笔交易
- **AND** 提示"单只标的持仓不得超过20%"

### Requirement: 策略级止损止盈
The system MUST 支持用户自定义止损止盈线（固定比例/动态追踪），当标的价格触及阈值时通过微信小程序推送风控提醒，引导用户手动决策。

#### Scenario: 固定比例止损
- **WHEN** 用户为某只股票设置10%固定止损线
- **AND** 该股票价格跌破买入价的10%
- **THEN** 系统应立即推送微信小程序通知
- **AND** 通知内容包含当前价格、阈值设置及策略历史表现
- **AND** 不自动执行卖出，等待用户手动决策

#### Scenario: 动态追踪止盈
- **WHEN** 用户为某只股票设置动态追踪止盈（回撤5%触发）
- **AND** 该股票价格从最高点回撤5%
- **THEN** 系统应推送微信小程序通知
- **AND** 提示"股票价格已从最高点回撤5%，建议考虑止盈"

#### Scenario: 批量设置止损止盈
- **WHEN** 用户为持仓的所有股票批量设置统一的止损止盈规则
- **THEN** 系统应将规则应用于所有持仓标的
- **AND** 支持后续为单个标的单独调整规则

### Requirement: 合规风控校验
The system MUST 内置监管规则校验（如创业板交易权限校验），禁止违规交易指令下发，确保交易行为符合《证券法》及金融监管总局要求。

#### Scenario: 创业板交易权限校验
- **WHEN** 用户尝试买入创业板股票
- **THEN** 系统应校验用户是否已开通创业板交易权限
- **AND** 如未开通，阻止交易并提示"请先开通创业板交易权限"

#### Scenario: 违规交易拦截
- **WHEN** 用户尝试执行违反监管规则的交易（如ST股票当日涨跌幅限制）
- **THEN** 系统应拦截该交易指令
- **AND** 提示具体违规原因及对应的法律条款

### Requirement: 风险归因分析
The system MUST 分析策略收益来源（市场β收益/策略α收益），识别核心风险因子（如行业集中度风险）。

#### Scenario: 计算市场β收益
- **WHEN** 用户查看策略的风险归因报告
- **THEN** 系统应计算策略收益中来自大盘走势的β收益部分
- **AND** 分离出策略本身创造的α收益
- **AND** 展示β和α的贡献比例

#### Scenario: 识别行业集中度风险
- **WHEN** 用户持仓集中于某一行业（如科技行业占比≥50%）
- **THEN** 系统应在风险报告中标注行业集中度风险
- **AND** 提示"当前持仓行业集中度较高，建议分散投资"

#### Scenario: 因子暴露分析
- **WHEN** 用户查看策略的因子暴露
- **THEN** 系统应分析策略对价值、成长、动量等因子的暴露程度
- **AND** 标注高暴露因子及其潜在风险

### Requirement: 极端市场压力测试
The system MUST 模拟极端市场行情（如历史重大事件期间的波动），测试策略抗风险能力，生成压力测试报告。

#### Scenario: 历史极端行情压力测试
- **WHEN** 用户选择"2023年硅谷银行事件"等历史极端行情场景
- **THEN** 系统应将策略在该时期的历史数据上运行回测
- **AND** 分析策略在极端行情下的最大回撤、持仓调整等表现
- **AND** 生成压力测试报告

#### Scenario: 自定义压力测试场景
- **WHEN** 用户自定义极端行情参数（如大盘单日跌幅10%）
- **THEN** 系统应模拟该场景并测试策略表现
- **AND** 输出策略在该假设场景下的收益与风险指标

### Requirement: 风控事件日志
The system MUST 记录所有风控事件（触发止损、超仓位限制等），提供完整的事件日志供用户查询与分析。

#### Scenario: 记录风控触发事件
- **WHEN** 系统触发任何风控规则（如止损、最大亏损限制）
- **THEN** 系统应记录事件时间、触发规则、标的信息、当前价格等详细信息
- **AND** 保存至风控事件日志

#### Scenario: 查询风控事件历史
- **WHEN** 用户查询过去一段时间的风控事件
- **THEN** 系统应返回按时间排序的事件列表
- **AND** 支持按标的、规则类型筛选
- **AND** 支持导出事件日志

### Requirement: 风控规则优先级管理
The system MUST 支持多条风控规则的优先级管理，当多条规则同时触发时按优先级执行。

#### Scenario: 设置规则优先级
- **WHEN** 用户同时设置了单日最大亏损和个股止损规则
- **THEN** 系统应允许用户设定规则执行的优先级
- **AND** 当多条规则同时触发时，优先执行高优先级规则

#### Scenario: 规则冲突处理
- **WHEN** 两条规则发生冲突（如止损要求卖出但仓位规则要求持仓）
- **THEN** 系统应按照用户设定的优先级执行
- **AND** 记录冲突事件并通知用户
